@page
@model ListLife.Pages.MyPageModel
@{
}


@if (TempData["Message"] != null)
{
    <div class="alert alert-@TempData["MessageType"]" role="alert">
        @TempData["Message"]
    </div>
}

<h1 class="Header">Your Shopping Lists</h1>

<section class="container">
    <!-- Om ingen lista är vald för redigering, visa shoppinglistor -->
    @if (Model.EditList == null || !Model.SharedShoppingLists.Contains(Model.EditList))
    {
        <div class="left-section">
            <h2>Your Lists</h2>
            <!-- Om användaren har egna shoppinglistor, visa dem -->
            @if (Model.ShoppingLists != null && Model.ShoppingLists.Any())
            {
                <ul class="list-group">
                    @foreach (var list in Model.ShoppingLists)
                    {
                        <li class="list-group-item">
                            <!-- Visar listans namn och gör det klickbart för att se detaljer -->
                            <span class="list-title" onclick="showListDetails('@list.Id')">@list.Title</span>
                            <div class="button-group">
                                <!-- Ta bort en shoppinglista -->
                                <form method="post" asp-page-handler="Delete" style="display:inline;">
                                    <input type="hidden" name="listId" value="@list.Id" />
                                    <button type="submit" class="btn btn-danger small-btn"><i class="bi bi-trash"></i></button>
                                </form>
                                <!-- Redigera en shoppinglista -->
                                <form method="post" asp-page-handler="Edit" style="display:inline;">
                                    <input type="hidden" name="listId" value="@list.Id" />
                                    <button type="submit" class="btn btn-primary small-btn"><i class="bi bi-pencil"></i></button>
                                </form>
                                <!-- Dela en shoppinglista -->
                                <form method="post" asp-page-handler="Share" style="display:inline;">
                                    <input type="hidden" name="listId" value="@list.Id" />
                                    <button type="submit" class="btn btn-success small-btn"><i class="bi bi-share"></i></button>
                                </form>
                            </div>
                        </li>
                    }
                </ul>
            }
            <!-- Knapp för att skapa en ny shoppinglista -->
            <form asp-page="/CreateNewShoppingList" method="get">
                <button type="submit" class="btnNewShoppingList">Create New Shopping List</button>
            </form>

            <h2>Shared Lists</h2>
            <!-- Visar delade listor -->
            @if (Model.SharedShoppingLists != null && Model.SharedShoppingLists.Any())
            {
                <ul class="list-group">
                    @foreach (var list in Model.SharedShoppingLists)
                    {
                        <li class="list-group-item">
                            <!-- Visar delad lista och gör den klickbar -->
                            <span class="list-title" onclick="showListDetails('@list.Id', true)">@list.Title</span>
                            <!-- Möjlighet att redigera den delade listan -->
                            <form method="post" asp-page-handler="Edit" style="display:inline;">
                                <input type="hidden" name="listId" value="@list.Id" />
                                <button type="submit" class="btn btn-primary small-btn"><i class="bi bi-pencil"></i></button>
                            </form>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p>No Shared Lists found.</p>
            }
        </div>
    }

    <!-- Om en lista är vald för redigering, visa edit-sektionen -->
    @if (Model.EditList != null)
    {
        <div class="edit-section">
            <h2>Edit Shopping List: @Model.EditList.Title</h2>
            <ul class="product-list">
                @foreach (var product in Model.EditList.Products)
                {
                    <li class="product-item">
                        <!-- Visar produkterna i listan -->
                        <span>@product.Name - @product.Amount @product.Category</span>
                        <!-- Ta bort en produkt från listan -->
                        <form method="post" asp-page-handler="DeleteProduct" asp-route-productId="@product.Id" style="display:inline;">
                            <button type="submit" class="btn btn-danger small-btn"><i class="bi bi-trash"></i></button>
                        </form>
                    </li>
                }
            </ul>

            <!-- Knapp för att lägga till en ny produkt -->
            <button type="button" class="btn btn-primary" onclick="showAddProductForm()">Add Product</button>
            <!-- Knapp för att gå tillbaka till startsidan -->
            <button type="button" class="btn btn-danger" onclick="window.location.href='/MyPage'">Back</button>

            <!-- Formulär för att lägga till en ny produkt -->
            <form method="post" asp-page-handler="AddProduct" id="addProductForm" style="display: none;">
                <input type="hidden" name="shoppingListId" value="@Model.EditList.Id" />
                <label for="ProductName">Product Name:</label>
                <input type="text" asp-for="AddNewProduct.Name" class="form-control" placeholder="Enter product name" />
                <label for="Amount">Amount:</label>
                <input type="number" asp-for="AddNewProduct.Amount" class="form-control" placeholder="Enter amount" />
                <label for="Category">Category:</label>
                <select asp-for="AddNewProduct.Category" class="form-control">
                    <option value="">--Select Category--</option>
                    <option value="FruitsVegetables">Fruits & Vegetables</option>
                    <option value="Fridge">Fridge items</option>
                    <option value="Freezer">Freezer items</option>
                    <option value="Pantry">Pantry items</option>
                    <option value="Hygiene">Hygiene items</option>
                    <option value="Other">Other</option>
                </select>
                <button type="submit" class="btn btn-primary">Add to Shoppinglist</button>
            </form>
        </div>
    }
</section>

<script>
    // Funktion för att visa formuläret för att lägga till en produkt
    function showAddProductForm() {
        var form = document.getElementById("addProductForm");
        form.style.display = "block";
    }
</script>

<style>
    /* Stil för rubrik */
    .Header {
        text-align: center;
        margin-bottom: 20px;
    }

    /* Stilar för layouten */
    .container {
        display: flex;
        justify-content: space-between;
        max-width: 1200px;
        margin: auto;
        gap: 20px;
    }

    /* Vänster sektion (shoppinglistor) */
    .left-section {
        flex: 1;
    }

    /* Höger sektion (redigering) */
    .edit-section {
        flex: 2;
        background-color: pink;
        padding: 20px;
        border-radius: 10px;
    }

    /* Stil för knappen att skapa ny shoppinglista */
    .btnNewShoppingList {
        display: block;
        width: 100%;
        background-color: blue;
        color: white;
        padding: 10px;
        text-align: center;
        margin-top: 10px;
        border: none;
        cursor: pointer;
    }

    /* Stil för listgrupper */
    .list-group {
        list-style: none;
        padding: 0;
    }

    /* Stil för enskilda listobjekt */
    .list-group-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #333;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 5px;
    }

    /* Stil för listtitlar */
    .list-title {
        flex-grow: 1;
        cursor: pointer;
        font-weight: bold;
        color: #ffffff;
    }

    /* Stil för knapparna i listan */
    .button-group {
        display: flex;
        gap: 5px;
    }

    /* Stil för enskilda produkter */
    .product-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #444;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 5px;
    }

    /* Stil för små knappar */
    .small-btn {
        padding: 4px 8px;
        font-size: 14px;
    }
</style>
